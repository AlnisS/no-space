<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Space Game</title>

    <style>
        html,
        body {
            margin: 0;
            width: 100%;
            height: 100%;
            user-select: none;
            background-color: white;
            font-family: sans-serif;
            touch-action: none;
        }

        .level-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .level {
            display: block;
            /* width: 400px; */
            /* height: 400px; */
            /* border: 1px black solid; */
            transform-style: preserve-3d;
            user-select: none;
            margin: auto auto;
            font-size: 20px;
        }





        node-visual-a {}

        node-visual-b {
            transform: rotateX(90deg);
        }

        node-visual-c {
            transform: rotateY(90deg);
        }

        node-visual-a,
        node-visual-b,
        node-visual-c {
            position: absolute;
        }

        .node {
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .node:hover {
            color: red;
        }

        .available {
            color: green;
        }

        .available:hover {
            color: greenyellow;
        }

        .start,
        .visited {
            color: rgb(146, 124, 0);
        }

        .start:hover,
        .visited:hover {
            color: rgb(146, 124, 0);
        }

        .active {
            color: gold;
        }

        .active:hover {
            color: gold;
        }

        .hidden {
            display: none !important;
        }

        .footer {
            position: absolute;
            display: flex;
            /* padding: 4px; */
            align-items: center;
            width: 100%;
            justify-content: center;
            bottom: 4px;
        }

        .game-title {
            position: absolute;
            top: 30px;
            width: 100%;
            font-size: x-large;
            text-align: center;
        }

        .reset-level {
            position: absolute;
            bottom: 50px;
            font-size: 60px;
            line-height: 60px;
            left: calc(50% - 30px);
            width: 60px;
            /* border: 1px black solid; */
            text-align: center;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="game-title">
        No Space Game
    </div>
    <div onclick="clearLevel()" class="reset-level">
        ðŸ—‘
    </div>
    <div class="footer">
        <div style="margin-right: 10px;">
            Level select:
        </div>
        <select id="level-select" onchange="onLevelSelect()">
            <option value="01">Level 1</option>
            <option value="02" disabled>Level 2</option>
            <option value="03" disabled>Level 3</option>
            <option value="04" disabled>Level 4</option>
            <option value="05" disabled>Level 5</option>
            <option value="06" disabled>Level 6</option>
            <option value="07" disabled>Level 7</option>
            <option value="08" disabled>Level 8</option>
            <option value="09" disabled>Level 9</option>
            <option value="cake" disabled>Cake</option>
        </select>
    </div>

    <div class="level-container">
        <div id="level-01" class="level" style="width: 200px; height: 200px;" data-nl="02">
            <div class="node start active" id="n-01-1-2-2"></div>
            <div class="node" id="n-01-2-2-2"></div>
            <div class="node" id="n-01-3-2-2"></div>
        </div>

        <div id="level-02" class="level hidden" style="width: 200px; height: 200px;" data-nl="03">
            <div class="node start active" id="n-02-1-2-2"></div>
            <div class="node" id="n-02-3-2-2"></div>
            <div class="node" id="n-02-1-1-2"></div>
            <div class="node" id="n-02-2-1-2"></div>
            <div class="node" id="n-02-3-1-2"></div>
            <div class="node" id="n-02-1-3-2"></div>
            <div class="node" id="n-02-2-3-2"></div>
            <div class="node" id="n-02-3-3-2"></div>
        </div>

        <div id="level-03" class="level hidden" style="width: 200px; height: 200px;" data-nl="04">
            <div class="node start active" id="n-03-1-2-1"></div>
            <div class="node" id="n-03-3-2-1"></div>
            <div class="node" id="n-03-1-1-1"></div>
            <div class="node" id="n-03-2-1-1"></div>
            <div class="node" id="n-03-3-1-1"></div>
            <div class="node" id="n-03-1-3-1"></div>
            <div class="node" id="n-03-2-3-1"></div>
            <div class="node" id="n-03-3-3-1"></div>

            <div class="node" id="n-03-1-1-2"></div>
            <div class="node" id="n-03-2-2-2"></div>

            <div class="node" id="n-03-1-2-3"></div>
            <div class="node" id="n-03-3-2-3"></div>
            <div class="node" id="n-03-1-1-3"></div>
            <div class="node" id="n-03-2-1-3"></div>
            <div class="node" id="n-03-2-2-3"></div>
            <div class="node" id="n-03-3-1-3"></div>
            <div class="node" id="n-03-1-3-3"></div>
            <div class="node" id="n-03-2-3-3"></div>
            <div class="node" id="n-03-3-3-3"></div>
        </div>

        <div id="level-04" class="level hidden" style="width: 200px; height: 200px;" data-nl="05">
            <div class="node start active" id="n-04-1-1-1"></div>
            <div class="node" id="n-04-1-2-1"></div>
            <div class="node" id="n-04-1-3-1"></div>
            <div class="node" id="n-04-1-1-2"></div>
            <div class="node" id="n-04-1-1-3"></div>
            <div class="node" id="n-04-1-2-3"></div>
            <div class="node" id="n-04-1-3-3"></div>
            <div class="node" id="n-04-1-3-2"></div>

            <div class="node" id="n-04-2-2-1"></div>
            <div class="node" id="n-04-2-1-1"></div>
            <div class="node" id="n-04-2-3-2"></div>
            <div class="node" id="n-04-2-3-3"></div>

            <div class="node" id="n-04-3-1-1"></div>
            <div class="node" id="n-04-3-2-1"></div>
            <div class="node" id="n-04-3-3-1"></div>
            <div class="node" id="n-04-3-1-2"></div>
            <div class="node" id="n-04-3-1-3"></div>
            <div class="node" id="n-04-3-2-3"></div>
            <div class="node" id="n-04-3-3-3"></div>
            <div class="node" id="n-04-3-3-2"></div>
        </div>

        <div id="level-05" class="level hidden" style="width: 200px; height: 200px;" data-nl="06">
            <div class="node start active" id="n-05-0-0-2"></div>
            <div class="node" id="n-05-1-0-2"></div>
            <div class="node" id="n-05-2-0-2"></div>
            <div class="node" id="n-05-3-0-2"></div>
            <div class="node" id="n-05-4-0-2"></div>

            <div class="node" id="n-05-0-1-2"></div>
            <div class="node" id="n-05-0-2-2"></div>
            <div class="node" id="n-05-0-3-2"></div>

            <div class="node" id="n-05-4-1-2"></div>
            <div class="node" id="n-05-4-2-2"></div>
            <div class="node" id="n-05-4-3-2"></div>

            <div class="node" id="n-05-0-4-2"></div>
            <div class="node" id="n-05-1-4-2"></div>
            <div class="node" id="n-05-2-4-2"></div>
            <div class="node" id="n-05-3-4-2"></div>
            <div class="node" id="n-05-4-4-2"></div>
        </div>

        <div id="level-06" class="level hidden" style="width: 200px; height: 200px;" data-nl="07">
            <div class="node start active" id="n-06-0-0-2"></div>
            <div class="node" id="n-06-1-0-2"></div>
            <div class="node" id="n-06-2-0-2"></div>
            <div class="node" id="n-06-3-0-2"></div>
            <div class="node" id="n-06-4-0-2"></div>

            <div class="node" id="n-06-0-1-2"></div>
            <div class="node" id="n-06-0-2-2"></div>
            <div class="node" id="n-06-0-3-2"></div>

            <div class="node" id="n-06-4-1-2"></div>
            <div class="node" id="n-06-4-2-2"></div>
            <div class="node" id="n-06-4-3-2"></div>

            <div class="node" id="n-06-0-4-2"></div>
            <div class="node" id="n-06-1-4-2"></div>
            <div class="node" id="n-06-2-4-2"></div>
            <div class="node" id="n-06-3-4-2"></div>
            <div class="node" id="n-06-4-4-2"></div>


            <div class="node" id="n-06-0-2-0"></div>
            <div class="node" id="n-06-1-2-0"></div>
            <div class="node" id="n-06-2-2-0"></div>
            <div class="node" id="n-06-3-2-0"></div>
            <div class="node" id="n-06-4-2-0"></div>

            <div class="node" id="n-06-0-2-1"></div>
            <div class="node" id="n-06-0-1-1"></div>
            <div class="node" id="n-06-4-2-1"></div>
            <div class="node" id="n-06-0-2-3"></div>
            <div class="node" id="n-06-4-2-3"></div>
            <div class="node" id="n-06-4-3-3"></div>

            <div class="node" id="n-06-0-2-4"></div>
            <div class="node" id="n-06-1-2-4"></div>
            <div class="node" id="n-06-2-2-4"></div>
            <div class="node" id="n-06-3-2-4"></div>
            <div class="node" id="n-06-4-2-4"></div>
        </div>

        <div id="level-07" class="level hidden" style="width: 200px; height: 200px;" data-nl="08">
            <div class="node" id="n-07-0-2-2"></div>
            <div class="node" id="n-07-1-2-2"></div>
            <div class="node start active" id="n-07-2-2-2"></div>
            <div class="node" id="n-07-3-2-2"></div>
            <div class="node" id="n-07-4-2-2"></div>

            <div class="node" id="n-07-0-1-2"></div>
            <div class="node" id="n-07-1-1-2"></div>
            <div class="node" id="n-07-2-1-2"></div>
            <div class="node" id="n-07-3-1-2"></div>
            <div class="node" id="n-07-4-1-2"></div>

            <div class="node" id="n-07-0-3-2"></div>
            <div class="node" id="n-07-1-3-2"></div>
            <div class="node" id="n-07-2-3-2"></div>
            <div class="node" id="n-07-3-3-2"></div>
            <div class="node" id="n-07-4-3-2"></div>


            <div class="node" id="n-07-1-2-0"></div>
            <div class="node" id="n-07-1-2-1"></div>
            <!-- <div class="node" id="n-07-1-2-2"></div> -->
            <div class="node" id="n-07-1-2-3"></div>
            <div class="node" id="n-07-1-2-4"></div>

            <div class="node" id="n-07-3-2-0"></div>
            <div class="node" id="n-07-3-2-1"></div>
            <!-- <div class="node" id="n-07-3-2-2"></div> -->
            <div class="node" id="n-07-3-2-3"></div>
            <div class="node" id="n-07-3-2-4"></div>

            <div class="node" id="n-07-2-2-4"></div>
            <div class="node" id="n-07-2-2-0"></div>
        </div>

        <div id="level-08" class="level hidden" style="width: 200px; height: 200px;" data-nl="09">
            <div class="node" id="n-08-0-2-2"></div>
            <div class="node" id="n-08-1-2-2"></div>
            <div class="node start active" id="n-08-2-2-2"></div>
            <div class="node" id="n-08-3-2-2"></div>
            <div class="node" id="n-08-4-2-2"></div>

            <div class="node" id="n-08-0-1-2"></div>
            <div class="node" id="n-08-1-1-2"></div>
            <div class="node" id="n-08-2-1-2"></div>
            <div class="node" id="n-08-3-1-2"></div>
            <div class="node" id="n-08-4-1-2"></div>

            <div class="node" id="n-08-0-3-2"></div>
            <div class="node" id="n-08-1-3-2"></div>
            <div class="node" id="n-08-2-3-2"></div>
            <div class="node" id="n-08-3-3-2"></div>
            <div class="node" id="n-08-4-3-2"></div>


            <div class="node" id="n-08-1-2-0"></div>
            <div class="node" id="n-08-1-2-1"></div>
            <!-- <div class="node" id="n-08-1-2-2"></div> -->
            <div class="node" id="n-08-1-2-3"></div>
            <div class="node" id="n-08-1-2-4"></div>

            <div class="node" id="n-08-3-2-0"></div>
            <div class="node" id="n-08-3-2-1"></div>
            <!-- <div class="node" id="n-08-3-2-2"></div> -->
            <div class="node" id="n-08-3-2-3"></div>
            <div class="node" id="n-08-3-2-4"></div>

            <div class="node" id="n-08-2-2-4"></div>
            <div class="node" id="n-08-2-2-3"></div>
            <div class="node" id="n-08-2-2-0"></div>
            <div class="node" id="n-08-2-2-1"></div>

            <div class="node" id="n-08-2-1-3"></div>
        </div>

        <div id="level-09" class="level hidden" style="width: 200px; height: 200px;" data-nl="cake">
            <div class="node start active" id="n-09-0-0-0"></div>
            <div class="node" id="n-09-1-0-0"></div>
            <div class="node" id="n-09-2-0-0"></div>
            <div class="node" id="n-09-3-0-0"></div>
            <div class="node" id="n-09-4-0-0"></div>

            <div class="node" id="n-09-4-1-0"></div>

            <div class="node" id="n-09-0-2-0"></div>
            <div class="node" id="n-09-1-2-0"></div>
            <div class="node" id="n-09-2-2-0"></div>
            <div class="node" id="n-09-3-2-0"></div>
            <div class="node" id="n-09-4-2-0"></div>

            <div class="node" id="n-09-0-3-0"></div>

            <div class="node" id="n-09-0-4-0"></div>
            <div class="node" id="n-09-1-4-0"></div>
            <div class="node" id="n-09-2-4-0"></div>
            <div class="node" id="n-09-3-4-0"></div>
            <div class="node" id="n-09-4-4-0"></div>

            <div class="node" id="n-09-4-4-1"></div>

            <div class="node" id="n-09-0-4-2"></div>
            <div class="node" id="n-09-1-4-2"></div>
            <div class="node" id="n-09-2-4-2"></div>
            <div class="node" id="n-09-3-4-2"></div>
            <div class="node" id="n-09-4-4-2"></div>

            <div class="node" id="n-09-0-4-3"></div>

            <div class="node" id="n-09-0-4-4"></div>
            <div class="node" id="n-09-1-4-4"></div>
            <div class="node" id="n-09-2-4-4"></div>
            <div class="node" id="n-09-3-4-4"></div>
            <div class="node" id="n-09-4-4-4"></div>

            <div class="node" id="n-09-4-3-4"></div>

            <div class="node" id="n-09-0-2-4"></div>
            <div class="node" id="n-09-1-2-4"></div>
            <div class="node" id="n-09-2-2-4"></div>
            <div class="node" id="n-09-3-2-4"></div>
            <div class="node" id="n-09-4-2-4"></div>

            <div class="node" id="n-09-0-1-4"></div>

            <div class="node" id="n-09-0-0-4"></div>
            <div class="node" id="n-09-1-0-4"></div>
            <div class="node" id="n-09-2-0-4"></div>
            <div class="node" id="n-09-3-0-4"></div>
            <div class="node" id="n-09-4-0-4"></div>

            <div class="node" id="n-09-4-0-3"></div>

            <div class="node" id="n-09-0-0-2"></div>
            <div class="node" id="n-09-1-0-2"></div>
            <div class="node" id="n-09-2-0-2"></div>
            <div class="node" id="n-09-3-0-2"></div>
            <div class="node" id="n-09-4-0-2"></div>

            <div class="node" id="n-09-0-0-1"></div>
        </div>


        <div id="level-cake" class="level hidden">
            <div style="text-align: center;">
                You finished the game.<br />
                ðŸŽ‰ Congrats! ðŸŽ‰<br />
                Thank you for playing.
            </div>
            <div style="text-align: center; font-size: 100px;">
                ðŸŽ‚
            </div>
        </div>
    </div>

    <script>

        // document.querySelectorAll(`option`).forEach(o => o.disabled = false);

        const GRID_SCALE = 50.0;

        var mouseDown = 0;
        var rotH = 45.0;
        var rotV = -30.0;
        var currentLevel = document.getElementById('level-01');
        // console.log(currentLevel);
        updateLevelRotation();

        // EVENT HANDLERS

        document.body.onpointerdown = (e) => {
            mouseDown = true;
        };
        document.body.onpointerup = (e) => {
            mouseDown = false;
        };
        document.body.onpointermove = (event) => {
            if (mouseDown) {
                rotH += event.movementX;
                rotV = Math.min(Math.max(rotV - event.movementY, -90.0), 90.0);
                updateLevelRotation();
            }
        }



        // SET UP NODE VISUALS FOR ALL LEVELS

        for (node of document.querySelectorAll('.node')) {
            node.appendChild(document.createElement('node-visual-a'));
            node.appendChild(document.createElement('node-visual-b'));
            node.appendChild(document.createElement('node-visual-c'));
            let [n, level, x, y, z] = node.id.split('-').map((e) => e * GRID_SCALE);
            node.style.transform = `translate3d(${x}px, ${y}px, ${z - 100}px)`;
            let id = node.id;
            node.onclick = () => onNodeClick(id);
        }

        for (visual of document.querySelectorAll('node-visual-a, node-visual-b, node-visual-c')) {
            visual.innerText = "â—¯";
        }


        // SET UP LEVEL

        function setUpLevel(name) {
            currentLevel.classList.add('hidden');
            currentLevel = document.getElementById(`level-${name}`);
            currentLevel.classList.remove('hidden');
            if (name == 'cake') {
                document.querySelector('.reset-level').classList.add('hidden');
                rotH = 0.0;
                rotV = 0.0;
            } else {
                rotH = 45.0;
                rotV = -30.0;
                document.querySelector('.reset-level').classList.remove('hidden');
                clearAvailable();
                markAvailable();
            }
            updateLevelRotation();
        }



        setUpLevel('01');




        // LEVEL WRANGLING FUNCTIONS

        function verifyLevelCompletion() {
            for (node of currentLevel.querySelectorAll('.node')) {
                if (!(node.classList.contains('visited') || node.classList.contains('active'))) {
                    return false;
                }
            }
            return true;
        }

        function onLevelSelect() {
            setUpLevel(document.getElementById('level-select').value);
        }

        function clearLevel() {
            for (node of currentLevel.querySelectorAll('.node')) {
                node.classList.remove('visited');
                node.classList.remove('active');
            }
            currentLevel.querySelector('.start').classList.add('active');
            clearAvailable();
            markAvailable();
        }


        // NODE WRANGLING FUNCTIONS

        function onNodeClick(id) {
            let clicked = currentLevel.querySelector(`#${id}`);

            if (!clicked.classList.contains('available'))
                return;

            let lastActive = currentLevel.querySelector('.active');
            lastActive.classList.remove('active');
            lastActive.classList.add('visited');
            clicked.classList.add('active');
            clearAvailable();
            markAvailable();

            if (verifyLevelCompletion()) {
                // console.log('level complete!');
                let nextLevel = currentLevel.getAttribute('data-nl');
                // console.log(nextLevel);
                document.querySelector(`option[value="${nextLevel}"]`).disabled = false;
                document.getElementById('level-select').value = nextLevel;
                setUpLevel(nextLevel);
            }
        }

        function clearAvailable() {
            currentLevel.querySelectorAll('.node').forEach((node) => node.classList.remove('available'));
        }

        function markAvailable() {
            let active = currentLevel.querySelector('.active');
            for (neighbor of getNeighbors(active.id)) {
                if (neighbor && !neighbor.classList.contains('visited'))
                    neighbor.classList.add('available');
            }
        }

        function getNeighbors(id) {
            let [n, level, x, y, z] = id.split('-')
            let neighborIds = [
                `${n}-${level}-${parseFloat(x) + 1}-${y}-${z}`,
                `${n}-${level}-${parseFloat(x) - 1}-${y}-${z}`,
                `${n}-${level}-${x}-${parseFloat(y) + 1}-${z}`,
                `${n}-${level}-${x}-${parseFloat(y) - 1}-${z}`,
                `${n}-${level}-${x}-${y}-${parseFloat(z) + 1}`,
                `${n}-${level}-${x}-${y}-${parseFloat(z) - 1}`,
            ];
            let neighbors = neighborIds.map((i) => currentLevel.querySelector(`#${i}`));
            return neighbors;
        }


        // MISC FUNCTIONS

        function updateLevelRotation() {
            currentLevel.style.transform = `perspective(750px) rotateX(${rotV}deg) rotateY(${rotH}deg)`
        }
    </script>
</body>

</html>